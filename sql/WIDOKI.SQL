-- LICZBA ZAKAŻEŃ Z PODZIAŁEM NA PAŃSTWO (DODATKOWO % UDZIAŁ W ZAKAŻENIACH GLOBALNYCH)
CREATE VIEW Zakazenia_panstwo AS
SELECT
	KRAJ,
    KOD,
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2) * 100, 2), ' %') AS 'Udzial (%)'
FROM covid_tygodniowe
WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2
GROUP BY KRAJ, KOD
ORDER BY SUM(PRZYPADKI_TYG) DESC;

-- LICZBA ZAKAŻEŃ Z PODZIAŁEM NA KONTYNENT (DODATKOWO % UDZIAŁ W ZAKAŻENIACH GLOBALNYCH)
CREATE VIEW Zakazenia_kontynent AS
SELECT
	KRAJ AS 'KONTYNENT',
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE DAYOFWEEK(DZIEN) = 2 AND KRAJ IN ('Oceania','Europe','Asia','South America','North America','Africa')) * 100, 2), ' %') AS 'UDZIAL (%)'
FROM covid_tygodniowe
WHERE DAYOFWEEK(DZIEN) = 2 AND KRAJ IN ('Oceania','Europe','Asia','South America','North America','Africa')
GROUP BY KRAJ
ORDER BY SUM(PRZYPADKI_TYG) DESC;

-- LICZBA ZAKAŻEŃ Z PODZIAŁEM NA STATUS EKONOMICZNY (DODATKOWO % UDZIAŁ W ZAKAŻENIACH GLOBALNYCH)
CREATE VIEW Zakazenia_status_ekonomiczny AS
SELECT
	KRAJ,
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE KRAJ LIKE '%income%') * 100, 2), ' %') AS 'UDZIAL (%)'
FROM covid_tygodniowe
WHERE KRAJ LIKE '%income%'
GROUP BY KRAJ
ORDER BY SUM(PRZYPADKI_TYG) DESC;

-- HEATMAPA ZAKAZEN COVID-19 (LATA I MIESIĄCE)
CREATE VIEW heat_map_zakazen_glo AS
SELECT
	YEAR(DZIEN) AS 'ROK',
    SUM(CASE WHEN MONTH(DZIEN) = 1 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Styczen',
    SUM(CASE WHEN MONTH(DZIEN) = 2 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Luty',
    SUM(CASE WHEN MONTH(DZIEN) = 3 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Marzec',
    SUM(CASE WHEN MONTH(DZIEN) = 4 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Kwiecien',
    SUM(CASE WHEN MONTH(DZIEN) = 5 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Maj',
    SUM(CASE WHEN MONTH(DZIEN) = 6 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Czerwiec',
    SUM(CASE WHEN MONTH(DZIEN) = 7 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Lipiec',
    SUM(CASE WHEN MONTH(DZIEN) = 8 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Sierpien',
    SUM(CASE WHEN MONTH(DZIEN) = 9 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Wrzesien',
    SUM(CASE WHEN MONTH(DZIEN) = 10 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Pazdziernik',
    SUM(CASE WHEN MONTH(DZIEN) = 11 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Listopad',
    SUM(CASE WHEN MONTH(DZIEN) = 12 THEN PRZYPADKI_TYG ELSE 0 END) AS 'Grudzien'
FROM covid_tygodniowe
WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2
GROUP BY YEAR(DZIEN);

-- HEATMAPA ZAKAZEN COVID-19 (KONTYNENTY I LATA)
CREATE VIEW heat_map_zakazen_kon AS
SELECT
	KRAJ AS 'KONTYNENT',
    SUM(CASE WHEN YEAR(DZIEN) = 2020 THEN PRZYPADKI_TYG ELSE 0 END) AS '2020',
    SUM(CASE WHEN YEAR(DZIEN) = 2021 THEN PRZYPADKI_TYG ELSE 0 END) AS '2021',
    SUM(CASE WHEN YEAR(DZIEN) = 2022 THEN PRZYPADKI_TYG ELSE 0 END) AS '2022',
    SUM(CASE WHEN YEAR(DZIEN) = 2023 THEN PRZYPADKI_TYG ELSE 0 END) AS '2023',
    SUM(CASE WHEN YEAR(DZIEN) = 2024 THEN PRZYPADKI_TYG ELSE 0 END) AS '2024',
    SUM(CASE WHEN YEAR(DZIEN) = 2025 THEN PRZYPADKI_TYG ELSE 0 END) AS '2025'
FROM covid_tygodniowe
WHERE KRAJ IN ('South America', 'North America', 'Oceania', 'Europe', 'Asia', 'Africa') AND DAYOFWEEK(DZIEN) = 2
GROUP BY KRAJ;

-- HEATMAPA ZAKAZEN COVID-19 (STATUS EKONOMICZNY I LATA)
CREATE VIEW heat_map_zakazen_ekon AS
SELECT
	KRAJ AS 'EKONOMIA',
    SUM(CASE WHEN YEAR(DZIEN) = 2020 THEN PRZYPADKI_TYG ELSE 0 END) AS '2020',
    SUM(CASE WHEN YEAR(DZIEN) = 2021 THEN PRZYPADKI_TYG ELSE 0 END) AS '2021',
    SUM(CASE WHEN YEAR(DZIEN) = 2022 THEN PRZYPADKI_TYG ELSE 0 END) AS '2022',
    SUM(CASE WHEN YEAR(DZIEN) = 2023 THEN PRZYPADKI_TYG ELSE 0 END) AS '2023',
    SUM(CASE WHEN YEAR(DZIEN) = 2024 THEN PRZYPADKI_TYG ELSE 0 END) AS '2024',
    SUM(CASE WHEN YEAR(DZIEN) = 2025 THEN PRZYPADKI_TYG ELSE 0 END) AS '2025'
FROM covid_tygodniowe
WHERE KRAJ LIKE '%income%' AND DAYOFWEEK(DZIEN) = 2
GROUP BY KRAJ;

-- TREND ZAKAZEN COVID-19 (TYGODNIOWY)
CREATE VIEW trend_tyg_global AS
SELECT
    YEAR(DZIEN) AS 'ROK',
    MONTH(DZIEN) AS 'MIESIAC',
    DATE_FORMAT(DZIEN,'%M') AS 'MIESIAC (NAZWA)',
    WEEKOFYEAR(DZIEN) AS 'TYDZIEN ROKU',
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2) * 100, 2), ' %') AS 'UDZIAL (%)'
FROM covid_tygodniowe
WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2
GROUP BY YEAR(DZIEN), MONTH(DZIEN), WEEKOFYEAR(DZIEN)
ORDER BY YEAR(DZIEN) ASC, WEEKOFYEAR(DZIEN) ASC;

-- TREND ZAKAZEN COVID-19 (MIESIECZNY)
CREATE VIEW trend_mie_global AS
SELECT
    YEAR(DZIEN) AS 'ROK',
    MONTH(DZIEN) AS 'MIESIAC',
    DATE_FORMAT(DZIEN,'%M') AS 'MIESIAC (NAZWA)',
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2) * 100, 2), ' %') AS 'UDZIAL (%)'
FROM covid_tygodniowe
WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2
GROUP BY YEAR(DZIEN), MONTH(DZIEN)
ORDER BY YEAR(DZIEN) ASC, MONTH(DZIEN) ASC;

-- TREND ZAKAZEN COVID-19 (ROCZNY)
CREATE VIEW trend_rok_global AS
SELECT
    YEAR(DZIEN) AS 'ROK',
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2) * 100, 2), ' %') AS 'UDZIAL (%)'
FROM covid_tygodniowe
WHERE KOD != 'OWI' AND KOD != '' AND DAYOFWEEK(DZIEN) = 2
GROUP BY YEAR(DZIEN)
ORDER BY YEAR(DZIEN) ASC;

-- NAJWIECEJ ZAKAZEN COVID-19 (ROK, MIESIAC, TYDZIEN)
CREATE VIEW max_zakazenia AS
SELECT
	YEAR(DZIEN) AS 'ROK',
    MONTH(DZIEN) AS 'MIESIAC',
	WEEKOFYEAR(DZIEN) AS 'TYDZIEN',
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    CONCAT(ROUND(SUM(PRZYPADKI_TYG) / (SELECT SUM(PRZYPADKI_TYG) FROM covid_tygodniowe WHERE KOD != '' AND KOD != 'OWI' AND DAYOFWEEK(DZIEN) = 2) * 100, 2), ' %') AS 'UDZIAL (%)'
FROM covid_tygodniowe
WHERE KOD != '' AND KOD != 'OWI' AND DAYOFWEEK(DZIEN) = 2
GROUP BY YEAR(DZIEN), MONTH(DZIEN), WEEKOFYEAR(DZIEN)
ORDER BY SUM(PRZYPADKI_TYG) DESC;

-- SREDNIA ZAKAZEN TYGODNIOWA (ROCZNIE)
CREATE VIEW sr_zakazen_tyg_rocz AS
SELECT
	KRAJ,
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    AVG(CASE WHEN YEAR(DZIEN) = 2020 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (2020)',
    AVG(CASE WHEN YEAR(DZIEN) = 2021 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (2021)',
    AVG(CASE WHEN YEAR(DZIEN) = 2022 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (2022)',
    AVG(CASE WHEN YEAR(DZIEN) = 2023 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (2023)',
    AVG(CASE WHEN YEAR(DZIEN) = 2024 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (2024)',
    AVG(CASE WHEN YEAR(DZIEN) = 2025 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (2025)'
FROM covid_tygodniowe
WHERE KOD != '' AND KOD != 'OWI' AND DAYOFWEEK(DZIEN) = 2
GROUP BY KRAJ
ORDER BY SUM(PRZYPADKI_TYG) DESC;

-- SREDNIA ZAKAZEN TYGODNIOWA (MIESIECZNIE)
CREATE VIEW sr_zakazen_tyg_mies AS
SELECT
	KRAJ,
    SUM(PRZYPADKI_TYG) AS 'LICZBA ZAKAZEN COVID-19',
    AVG(CASE WHEN MONTH(DZIEN) = 1 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (STYCZEN)',
    AVG(CASE WHEN MONTH(DZIEN) = 2 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (LUTY)',
    AVG(CASE WHEN MONTH(DZIEN) = 3 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (MARZEC)',
    AVG(CASE WHEN MONTH(DZIEN) = 4 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (KWIECIEN)',
    AVG(CASE WHEN MONTH(DZIEN) = 5 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (MAJ)',
    AVG(CASE WHEN MONTH(DZIEN) = 6 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (CZERWIEC)',
    AVG(CASE WHEN MONTH(DZIEN) = 7 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (LIPIEC)',
    AVG(CASE WHEN MONTH(DZIEN) = 8 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (SIERPIEN)',
    AVG(CASE WHEN MONTH(DZIEN) = 9 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (WRZESIEN)',
    AVG(CASE WHEN MONTH(DZIEN) = 10 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (PAZDZIERNIK)',
    AVG(CASE WHEN MONTH(DZIEN) = 11 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (LISTOPAD)',
    AVG(CASE WHEN MONTH(DZIEN) = 12 THEN PRZYPADKI_TYG END) AS 'SR. ZAKAZEN (GRUDZIEN)'
FROM covid_tygodniowe
WHERE KOD != '' AND KOD != 'OWI' AND DAYOFWEEK(DZIEN) = 2
GROUP BY KRAJ
ORDER BY SUM(PRZYPADKI_TYG) DESC;


